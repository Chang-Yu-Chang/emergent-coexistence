---
title: "Diagonal analysis of competitive network"
author: "Chang-Yu Chang"
date: "`r Sys.Date()`"
output:
  html_notebook:
    toc: yes
    number_sections: no
---

```{r setup, include = FALSE}
# Knitr options
knitr::opts_chunk$set(cache = TRUE, echo = FALSE)
library(tidyverse)
library(data.table)
library(igraph)
```



# Competitive hierarchy 

```{r}
source("script/03C-diagnonal_analysis-01-competitive_hierarchy.R")
```

The competitive scores for all pairs are converted into a pairwise competitive matrix, with a value of "1" representing a win and a value of "0" representing a loss. Pairings that resulted on a draw were assingned a value of 0.5, representing coexistence.

The competitive intransitivity is determined as follow

$$\frac{\sum I{a_{ij}<a_{ji}}}{n(n-1)/2}$$

# Diagonal analysis

```{r}
# It takes 26 minutes to run this script
source("script/03C-diagnonal_analysis-02-distance_to_diagonal.R")
```

For record, it took 1655 seconds ~= 26 minutes to compute the diagonal measures for 13 communities X 10000 randomization, merge them into one single data frame.

`data/output/networks_diag`

`data/output/networks_diag_randomized`

For a network matrix $m_{ij}$, the fraction of coexistence as a fucntion of distance to diagonal is calculated as the

$$\frac{}{\lvert i-j \lvert}$$
 
`networks_diag_randomized` has four columns

`Randomization`: the number of randomization 

```{r}
networks_diag_randomized
```


# Plot the diagonal analysis

```{r}
source("script/03C-diagnonal_analysis-03-plot_diagonal_analysis.R")
```


```{r fig.width = 5, fig.height = 5}
ggsave(here::here("output/report/figure/03C-diagonal_analysis-networks_diagonal.png"), p_networks_diag, width = 10, height = 10)
```



```{r fig.width = 9, fig.height = 3}
p_networks_diag_pool <- cowplot::plot_grid(p_networks_diag_pool1, p_networks_diag_pool2, p_networks_diag_pool3, ncol = 3, align = "h")

ggsave(here::here("output/report/figure/03C-diagonal_analysis-networks_diagonal_pool.png"), p_networks_diag_pool, width = 10, height = 3)

```






