---
title: "Network motifs in communities"
author: "Chang-Yu Chang"
date: "`r Sys.Date()`"
output:
  html_notebook:
    toc: yes
    number_sections: no
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(cache = TRUE, echo = FALSE)
library(tidyverse)
library(data.table)
library(igraph)
library(tidygraph)
library(ggraph)
library(cowplot)
```


# Goal {-}

- Make community network from `data/output/pairs.csv`.

- Plot networks and matrices

For `R >= 3.5.0`, use `BiocManager::install()` instead of `biocLite()` to install Bioconductor-mentained packages. 

```{r eval = F, echo = T}
#install.packages("PlayerRatings") # Calculate the rank
install.packages("igraph") # Network analysis
```


# Make network

```{r}
source("script/03A-make_network-01-make_pairwise_network.R")
```


```{r fig.width=10, fig.height=8}
plot_grid(plotlist = p_net_tbl_list, ncol = 4)
```



# Pairwise matrice

```{r}
source("script/03A-make_network-02-pairwise_matrix.R")
```


Plot the communities' pairwise matrix, whose axis are ordered by competitive ranks

```{r}
p <- plot_grid(plotlist = p_net_matrix_plot_list, nrow = 2)
ggsave(here::here("output/report/figure/03A-make_network-adjacent_matrix.png"), plot = p, width = 10, height = 3)
```


# Randomize networks

```{r}
source("script/03A-make_network-03-randomize_network.R")
```

The R list for randomzied networks are saved within the R script. For record, it took 2603 seconds ~= 40 mins to generate 10000 randomized networks for each of 13 communities.

The randomized networks are saved in `data/output/network_randomized_list.Rdata` which contains a two-layer R list `net_randomized_list` in which the first layer has the 13 communities and the second layer has 10000 randomized networks.


Example of randomized network matrix

```{r fig.width = 3, fig.height = 3}
net_random_list$C11R2[[1]] %>% plot_adjacent_matrix(isolate_label = NULL)
```

