---
title: "Network motifs in communities"
author: "Chang-Yu Chang"
date: "`r Sys.Date()`"
output:
  html_notebook:
    number_sections: no
    toc: yes
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(cache = TRUE, echo = FALSE)
library(tidyverse)
library(data.table)
library(igraph)
library(tidygraph)
library(ggraph)

# Data
isolates <- fread(here::here("data/output/isolates.csv"))
pairs <- fread(here::here("data/output/pairs.csv"))
communities <- fread(here::here("data/output/communities.csv"))
communities_name <- communities$Community
communities_size <- communities$CommunitySize
communities_name_pool <- c(paste0("C", 1:12, "Rpool"), paste0("C", rep(1:12, each = 8), "R", rep(1:8, 12)))
families_name <- c("Aeromonadaceae", "Alcaligenaceae", "Bradyrhizobiaceae", "Brucellaceae", "Burkholderiaceae", "Caulobacteraceae", "Cellulomonadaceae", "Chitinophagaceae", "Chthoniobacteraceae", "Comamonadaceae", "Cryomorphaceae", "Enterobacteriaceae", "Enterococcaceae", "Flavobacteriaceae", "Hyphomicrobiaceae", "Listeriaceae", "Microbacteriaceae", "Moraxellaceae", "Nocardiaceae", "Obscuribacterales.17", "Oxalobacteraceae", "Paenibacillaceae", "Phyllobacteriaceae", "Porphyromonadaceae", "Pseudomonadaceae", "Rhizobiaceae", "Sanguibacteraceae", "Sphingobacteriaceae", "Sphingomonadaceae", "Xanthomonadaceae")
```



# Detect motifs in networks


```{r eval = F}
# This may take ~5 minutes for 1000 boostrapping
source("script/03B-invasion_network-01-detect_motif.R")
```

In this script, three objects are saved in a Rdata `data/temp/networks_motif_random.Rdata`

- `networks_motif`: dataframe
- `networks_motif_rand`: dataframe for all randomized networks motif counts
- `networks_motif_rand_percentile`: 5th and 95th percentile of motif counts


# Types of motifs in a pairwise competitive network

```{r}
source("script/03B-invasion_network-02-plot_motif.R")
```


```{r fig.width = 8, fig.height = 1.5}
p_motif_example
```


Detect motifs in randomized networks

```{r fig.width=5, fig.height=5}
ggsave(here::here("output/report/figure/03B-network_motif-motif_randomized.pdf"), p_motif_randomized, width = 10, height = 10)
```

Plot the histogram of randomized network motifs 

```{r fig.width = 10, fig.height = 15}
ggsave(here::here("output/report/figure/03B-network_motif-motif_histogram.pdf"), p_motif_randomized_histo, width = 20, height = 30); 
```


