---
title: "Single isolates OD-CFU conversion and comparison"
author: "Chang-Yu Chang"
date: "`r Sys.Date()`"
output:
  html_notebook:
    toc: yes
    number_sections: no
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(cache = TRUE, echo = FALSE)
library(tidyverse)
library(data.table)
```

# Goal

- Read ODs of isolates and pairs that were measured in pairwise competition experiment. `isolates_OD.csv`

- Read isolates' CFU on monoculture `isolates_CFU_T8.csv`

- Match isolates' OD and CFU `isolates_OD_CFU.csv`

- Calculate uncertainty in epsilon using error propagation theory

# Read OD (isolates and pairs)

Read the OD data generated from the analysis script for each experiment batch. The table below is the communities in each experimental batch.

Experimental batch | Community
-|-
B2 | C11R1 (except for isolate 1), C10R2, C2R6, C2R8, C7R1, C8R4
C | C11R1 isolate 1 (the OD data is in `OD_C2.csv`)
C2 | C11R2 
D2 | C11R5, C1R2, C1R4, C1R6, C1R7, C4R1

Read the OD files and export an overall OD data in csv `output/OD.csv` and an isolate OD csv `output/isolates_OD.csv`

```{r}
source("script/01C-isolates_OD_CFU-01-read_OD.R")
```

Isolate OD at each transfer. Abs values have been averaged out among replicates.

There are 68 isolates used in the pairwise competition experiments. 

Write all OD data in `data/temp/OD.csv` and isolate OD in `data/temp/isolates_OD.csv`

```{r}
isolates_OD
```

# Read isolates CFU

```{r}
source("script/01C-isolates_OD_CFU-02-read_CFU.R")
```

Colony counts at the given dilution factors. 

```{r}
isolates_CFU_T8
```

```{r}
isolates_OD_CFU
```


There are 68 isolates used in the pairwise competition experiments. 

Write isolate OD and CFU in `data/temp/isolates_OD_CFU.csv`


# Epsilon: OD-CFU conversion coefficient 

```{r warning = F}
source("script/01C-isolates_OD_CFU-03-epsilon.R")
```

To determine the outcomes of pairwise competition, I compare the frequencies changes between T1 and T8, which were empirically measured at different approaches and have to be converted into the same unit for comparion. 

- T1 frequencies are determined by mixing two isolate inocula with the standardized OD (OD620 = 0.1) at three initial frequencies: 5:95, 50:50, 95:5. T1 frequenxies are thus OD frequencies. 

- T8 frequencies are determinded by plating the mature media (48 hour growth cycle) on rich agar plates and counting the colony of each isolate. T8 frequencies are thus CFU frequencies. 

In this section, I convert the OD frequencies at T1 to CFU frequencies. For each isolate, the CFU and OD have the following relationships. 

$$CFU_A = \frac{OD_A DF_A v_A}{\epsilon_A}$$ 

$$CFU_A = \epsilon_A OD_A DF_A v_A$$ 

where $OD$ is the measured OD at 620 nm, $DF$ is the dilution factor ($10^4$ or $10^5$),  $v$ is the plating volume (20 uL for all experiment)  $\epsilon$ is the conversion coefficient between OD and CFU.  


```{r}
isolates_epsilon
```



